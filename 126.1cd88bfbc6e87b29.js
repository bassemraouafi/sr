"use strict";(self.webpackChunksr_stock=self.webpackChunksr_stock||[]).push([[126],{5126:(E,h,s)=>{s.r(h),s.d(h,{VenteModule:()=>U});var d=s(6895),u=s(1959),p=s(8505),t=s(1571),_=s(73),v=s(3188),f=s(9971),T=s(529),r=s(433),g=s(8423),y=s(4696),m=s(6392);function A(n,o){1&n&&(t.TgZ(0,"div",26),t._uU(1," La quantit\xe9 saisie d\xe9passe la quantit\xe9 disponible. "),t.qZA())}function Z(n,o){1&n&&(t.TgZ(0,"div",26),t._uU(1," La quantit\xe9 \xe0 d\xe9duire ne peut pas \xeatre n\xe9gative. "),t.qZA())}function b(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"div",9)(2,"label",22),t._uU(3),t.qZA(),t.TgZ(4,"div",23)(5,"input",24),t.NdJ("ngModelChange",function(c){const a=t.CHM(e).$implicit;return t.KtG(a.quantityToDeduct=c)}),t.qZA(),t.YNc(6,A,2,0,"div",25),t.YNc(7,Z,2,0,"div",25),t.qZA()()()}if(2&n){const e=o.$implicit,i=t.oxw(2);t.xp6(3),t.lnq("",e.stockName," (",e.articleQuantity," ",i.selectedArticle.storageUnit,")"),t.xp6(2),t.ekj("is-valid",e.quantityToDeduct<=e.articleQuantity)("is-invalid",e.quantityToDeduct>e.articleQuantity||e.quantityToDeduct<=0),t.Q6J("ngModel",e.quantityToDeduct),t.xp6(1),t.Q6J("ngIf",e.quantityToDeduct>e.articleQuantity),t.xp6(1),t.Q6J("ngIf",e.quantityToDeduct<0)}}function C(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div"),t.YNc(1,b,8,10,"div",19),t.TgZ(2,"button",21),t.NdJ("click",function(){t.CHM(e);const c=t.oxw();return t.KtG(c.addRow())}),t._uU(3," Ajouter "),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.stockData),t.xp6(1),t.Q6J("disabled",e.checkInvalidStockData())}}function q(n,o){if(1&n&&(t.TgZ(0,"div",27),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" Aucun stock disponible pour l'article \"",e.selectedArticle.designation,'". ')}}function x(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"input",33),t.NdJ("ngModelChange",function(c){t.CHM(e);const l=t.oxw(2);return t.KtG(l.newquantity=c)})("blur",function(){t.CHM(e);const c=t.oxw().$implicit,l=t.oxw();return t.KtG(l.saveQuantity(c))}),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("ngModel",e.newquantity)}}function M(n,o){if(1&n&&(t.TgZ(0,"div",34),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.errorMessage)}}function k(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"button",28),t.NdJ("click",function(){const l=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.removeRow(l))}),t._UZ(3,"i",29),t.qZA()(),t.TgZ(4,"td"),t._uU(5),t.ALo(6,"uppercase"),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"uppercase"),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td")(13,"span",30),t.NdJ("click",function(){const l=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.editQuantity(l))}),t._uU(14),t.qZA(),t.YNc(15,x,1,1,"input",31),t.YNc(16,M,2,1,"div",32),t.qZA()()}if(2&n){const e=o.$implicit;t.xp6(5),t.Oqu(t.lcZ(6,6,e.stockName)),t.xp6(3),t.Oqu(t.lcZ(9,8,e.designation)),t.xp6(3),t.Oqu(e.articleQuantity),t.xp6(3),t.Oqu(e.quantity),t.xp6(1),t.Q6J("ngIf",e.editing),t.xp6(1),t.Q6J("ngIf",e.errorMessage)}}function w(n,o){1&n&&(t.TgZ(0,"tr")(1,"td",35)(2,"p",36),t._uU(3,"Aucun resultat trouv\xe9"),t.qZA()()())}function Q(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",37)(1,"div",11)(2,"div",38)(3,"button",39),t.NdJ("click",function(){t.CHM(e);const c=t.oxw();return t.KtG(c.clearTab())}),t._UZ(4,"i",40),t._uU(5," Effacer tous "),t.qZA()(),t.TgZ(6,"div",41)(7,"button",42),t.NdJ("click",function(){t.CHM(e);const c=t.oxw();return t.KtG(c.sendMovements())}),t._UZ(8,"i",43),t._uU(9," Sortie de stock "),t.qZA()()()()}}const V=[{path:"",component:(()=>{class n{constructor(e,i,c,l,a,J,N){this.articleService=e,this.stockService=i,this.movmentService=c,this.router=l,this.http=a,this.fb=J,this.spinner=N,this.articles=[],this.selectedArticle=null,this.selectedArticleId=null,this.stockData=[],this.stockMovements=[]}ngOnInit(){this.getArticles()}getArticles(){this.spinner.show(),this.articleService.getAllArticles().pipe((0,p.b)(e=>{console.log(e),this.spinner.hide()})).subscribe({next:e=>{this.articles=e.content},error:e=>{this.spinner.hide(),console.log("Erreur lors de la r\xe9cup\xe9ration des articles :",e)}})}onArticleSelected(){this.selectedArticleId?(this.spinner.show(),this.selectedArticle=this.articles.find(e=>e.id===this.selectedArticleId)||null,this.getStockData(this.selectedArticle?.id)):(this.selectedArticle=null,console.log("Aucun article s\xe9lectionn\xe9."))}getStockData(e){return this.spinner.show(),this.http.get("http://102.219.178.147:8089/api/stock/"+e).pipe((0,p.b)(i=>{this.spinner.hide()})).subscribe(i=>{this.stockData=i},i=>{this.spinner.hide(),console.log("Erreur lors de la r\xe9cup\xe9ration des stocks :",i)})}addRow(){this.stockData&&this.stockData.length>0&&(this.stockData.forEach(e=>{if(e&&e.stockId&&null!=e.quantityToDeduct&&0!==e.quantityToDeduct){const i={stockId:e.stockId,stockName:e.stockName,articleId:this.selectedArticleId,quantity:e.quantityToDeduct,articleQuantity:e.articleQuantity,movementType:"OUT",designation:this.selectedArticle?.designation,editing:!1,errorMessage:null};this.stockMovements.push(i),console.log("new row"+JSON.stringify(i))}}),this.selectedArticle=null,this.selectedArticleId=null)}removeRow(e){const i=this.stockMovements.indexOf(e);-1!==i&&this.stockMovements.splice(i,1)}editQuantity(e){e.editing=!0}saveQuantity(e){if(console.log("the new : "+this.newquantity+" and old :"+e.quantity),null===this.newquantity||null===e.articleQuantity||0===this.newquantity||this.newquantity>e.articleQuantity)return console.log("Quantit\xe9 invalide"),e.errorMessage=e.articleQuantity+" < "+this.newquantity,this.newquantity=e.quantity,void(e.editing=!1);e.quantity=this.newquantity,e.errorMessage=null,e.editing=!1}sendMovements(){this.spinner.show(),console.log(this.stockMovements),this.movmentService.createMovment(this.stockMovements).pipe((0,p.b)(e=>{this.router.navigateByUrl("/dashboard"),this.spinner.hide()})).subscribe({next:e=>{this.spinner.hide(),console.log("Requ\xeate envoy\xe9e avec succ\xe8s",e)},error:e=>{this.spinner.hide(),console.error("Erreur lors de l'envoi de la requ\xeate",e)}})}checkInvalidStockData(){return this.stockData.every(e=>null==e.quantityToDeduct||e.quantityToDeduct<=0||e.quantityToDeduct>e.articleQuantity)}clearTab(){this.stockMovements=[]}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(_.n),t.Y36(v.q),t.Y36(f.U),t.Y36(u.F0),t.Y36(T.eN),t.Y36(r.qu),t.Y36(g.t2))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-vente"]],decls:37,vars:8,consts:[["bdColor","rgba(0, 0, 0, 0.8)","size","medium","color","#fff","type","square-jelly-box",3,"fullScreen"],[2,"color","white"],[1,"app-content","container","center-layout","mt-2"],[1,"content-overlay"],[1,"content-wrapper"],[1,"content-body"],[1,"col-md-12"],[1,"card"],[1,"card-header"],[1,"form-group","row"],["bindLabel","designation","bindValue","id","placeholder","S\xe9lectionnez un article",3,"items","ngModel","ngModelChange"],[1,"row"],[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"card-content"],[1,"card-body"],[1,"table","table-striped","table-responsive-md","table-list"],[1,"w-25"],[1,"w-50"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],[1,"btn","btn-icon","btn-pink","mr-1","mb-1","float-right",3,"disabled","click"],[1,"col-md-3","label-control"],[1,"col-md-9"],["type","number","placeholder","Quantit\xe9 \xe0 d\xe9duire","inputmode","numeric","min","0","pattern","[0-9]+",1,"form-control",3,"ngModel","ngModelChange"],["class","invalid-feedback  d-block",4,"ngIf"],[1,"invalid-feedback","d-block"],[1,"alert","alert-danger"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"fa","fa-trash"],[3,"click"],["type","number",3,"ngModel","ngModelChange","blur",4,"ngIf"],["class","error-message",4,"ngIf"],["type","number",3,"ngModel","ngModelChange","blur"],[1,"error-message"],["colspan","5"],[2,"text-align","center"],[1,"card-footer"],[1,"col-md-3","mb-2"],["type","button",1,"btn","btn-info","btn-block",3,"click"],[1,"fa","fa-trash-o"],[1,"col-md-9","mb-2"],["type","button",1,"btn","btn-warning","btn-block",3,"click"],[1,"fa","fa-minus"]],template:function(e,i){1&e&&(t._UZ(0,"app-navbar"),t.TgZ(1,"ngx-spinner",0)(2,"p",1),t._uU(3," Loading... "),t.qZA()(),t.TgZ(4,"div",2),t._UZ(5,"div",3),t.TgZ(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",6)(13,"ng-select",10),t.NdJ("ngModelChange",function(l){return i.selectedArticleId=l})("ngModelChange",function(){return i.onArticleSelected()}),t.qZA()()(),t.TgZ(14,"div",11)(15,"div",6),t.YNc(16,C,4,2,"div",12),t.YNc(17,q,2,1,"div",13),t.qZA()()(),t.TgZ(18,"div",14)(19,"div",15)(20,"div")(21,"table",16)(22,"thead")(23,"tr"),t._UZ(24,"th"),t.TgZ(25,"th",17),t._uU(26,"STOCK"),t.qZA(),t.TgZ(27,"th",18),t._uU(28,"D\xc9SIGNATION"),t.qZA(),t.TgZ(29,"th"),t._uU(30,"EN STOCK"),t.qZA(),t.TgZ(31,"th"),t._uU(32,"QUANTIT\xc9"),t.qZA()()(),t.TgZ(33,"tbody"),t.YNc(34,k,17,10,"tr",19),t.YNc(35,w,4,0,"tr",12),t.qZA()()()()(),t.YNc(36,Q,10,0,"div",20),t.qZA()()()()()),2&e&&(t.xp6(1),t.Q6J("fullScreen",!0),t.xp6(12),t.Q6J("items",i.articles)("ngModel",i.selectedArticleId),t.xp6(3),t.Q6J("ngIf",i.selectedArticle&&i.stockData.length>0),t.xp6(1),t.Q6J("ngIf",i.selectedArticle&&0==i.stockData.length),t.xp6(17),t.Q6J("ngForOf",i.stockMovements),t.xp6(1),t.Q6J("ngIf",0===i.stockMovements.length),t.xp6(1),t.Q6J("ngIf",0!=i.stockMovements.length))},dependencies:[d.sg,d.O5,y.S,m.w9,r.Fj,r.wV,r.JJ,r.c5,r.qQ,r.On,g.Ro,d.gd],styles:[".custom-class.ng-select[_ngcontent-%COMP%]{width:80%}.designation-col[_ngcontent-%COMP%]{width:50%}"]}),n})()}];let I=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.Bz.forChild(V),u.Bz]}),n})();var D=s(4466);let U=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.ez,I,D.m,m.A0,r.u5,g.ef]}),n})()}}]);